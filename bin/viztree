#! /bin/sh

#declare functions
function usage ()
{
   cat << EOF
Usage: $0 [-h] [-t type] tree-file
Parameters:
  -t type      define type of output file (default ps)
  -h           display this message
EOF
exit 0
}

function error ()
{
  echo error: $1
  exit 1
}

#process options
while getopts ":ht:" opt; do
   case $opt in
   \? ) usage;;
   h )  usage;;
   t )  type=$OPTARG;;
   esac
done
if [ -z $type ]; then type=ps; fi
shift $(($OPTIND - 1))

#check validity of file argument
if [ $# -ne 1 ]; then usage; fi
if [ ! -e $1 ];  then error "file $1 does not exist"; fi  

#convert tree-file to graphic file with type $type
filename=$(sed -e 's/\(.*\)\.[a-z0-9]*$/\1/' <<< $1)
tree2graph -i $1 | graph2dot | dot -T${type} -o ${filename}.${type}
if [ -e ${filename}.${type} ]; then
  echo "wrote vizualisation to ${filename}.${type}"
  exit 0
else 
  exit 1
fi
