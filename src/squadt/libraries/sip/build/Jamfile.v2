project squadt/libraries/sip
    : source-location
       ../source
    : build-dir $(BUILD_TOP)
    : requirements
       <use>/boost//headers
       <include>../include
    : usage-requirements
       <use>/boost//headers
       <include>../include
    ;

transport_sources = [ glob ../source/transport/*.cpp ] ;

alias transport
    : $(transport_sources)
    : <library>/site-config//boost_thread
      <library>/site-config//boost_system
      <toolset>darwin,<link>shared:<linkflags>"-undefined dynamic_lookup"
      <os>CYGWIN:<define>__USE_W32_SOCKETS
      <os>CYGWIN:<define>_WIN32_WINNT=0x0500
      <os>NT:<define>__USE_W32_SOCKETS
      <os>NT:<define>_WIN32_WINNT=0x0500
      <threading>multi
    :
    : <library>/site-config//boost_thread
      <library>/site-config//boost_system
      <os>NT:<library>/site-config//winsock
      <os>CYGWIN:<library>/site-config//winsock
      <os>CYGWIN:<define>__USE_W32_SOCKETS
      <os>CYGWIN:<define>_WIN32_WINNT=0x0500
      <os>NT:<define>__USE_W32_SOCKETS
      <os>NT:<define>_WIN32_WINNT=0x0500
    ;

obj restore_visitor.o
    : restore_visitor.cpp
    : <use>/libraries/utility//headers
      <use>/libraries//ticpp
      <use>/site-config//boost_filesystem
    :
    : <library>/libraries//ticpp
      <library>/site-config//boost_filesystem
    ;

alias messenger
    : # no sources
      basic_datatype.cpp
      basic_messenger.cpp
      capabilities.cpp
      common.cpp
      command_line_interface.cpp
      configuration.cpp
      layout.cpp
      layout_base.cpp
      layout_elements.cpp
      mime_type.cpp
      transport
      store_visitor.cpp
      restore_visitor.o
    : <threading>multi
      <dependency>/site-config//boost_regex
      <dependency>/site-config//boost_filesystem
      <dependency>/libraries/utility//logger
    : # no default build
    : <library>/site-config//boost_regex
      <library>/site-config//boost_filesystem
      <library>/libraries/utility//logger
    ;

lib sip_controller
    : controller.cpp
      messenger
    : <threading>multi
      <link>static
    ;

lib sip
    : controller.cpp
      tool.cpp
      messenger
    : <threading>multi
      <link>shared
    ;

lib sip_tool
    : tool.cpp
      messenger
    : <threading>multi
      <link>static
    ;

alias sip_tool : sip ;

alias sip_controller : sip ;

