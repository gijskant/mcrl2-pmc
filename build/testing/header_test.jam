# Author: Jeroen van der Wulp
# Copyright: see the accompanying file COPYING.
#
# Distributed under the Boost Software License, Version 1.0.
# (See accompanying file LICENSE_1_0.txt or copy at
# http://www.boost.org/LICENSE_1_0.txt)
import testing ;

if test-headers in [ MATCH "^-?-?(test-headers)" : [ modules.peek : ARGV ] ] {
  import path ;
  import regex ;
  import project ;

  rule compile-headers ( path ) {
    local current-project = [ project.current ] ;

    local source-location =
      [ path.root $(path) [ $(current-project).get source-location ] ] ;

    files = [ path.glob-tree $(source-location) : *.h *.hpp ] ;

    for local file in $(files) {
      local relative-path = [ path.relative-to $(source-location) $(file) ] ;

      result += [ compile $(TOP)/build/testing/header_test.cpp
        : <define>BOOST_UNITS_HEADER_NAME=$(relative-path)
        : [ regex.replace $(relative-path) "/" "_" ] ] ;
    }

    return $(result) ;
  }
}
else {
  rule compile-headers ( base ) {
  }
}
